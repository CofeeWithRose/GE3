<!DOCTYPE html>
<html>

<head>
	<style>
		html,
		body {
			margin: 0;
			padding: 0;
			width: 100%;
			height: 100%;
		}
	</style>
	<script type="text/javascript" src="findPath2.js" charset="utf-8"></script>
	<title>findPath</title>
</head>

<body>
	<canvas id="canvas"></canvas>
</body>
<script>
	var canvas = document.getElementById("canvas");
	canvas.width = window.innerWidth;
	canvas.height = window.innerHeight;
	var context = canvas.getContext("2d");


	//点与点。
	/**
	 * 1.找与点相通的点,累加与根目录的距离.
	 * 2.判断点是否到过且最短.
	 * 3.找下一个点.
	 */

	//构造地图.A-H点，两两相连，默认为静态点.
	var map = new PD.MapData();

	var pointA = new PD.Vectort2(1, 0);
	var pointB = new PD.Vectort2(2, 0);
	var pointC = new PD.Vectort2(1, 2);
	var pointD = new PD.Vectort2(2, 2);
	var pointE = new PD.Vectort2(0, 2);
	var pointF = new PD.Vectort2(0, 3);
	var pointG = new PD.Vectort2(3, 3);
	var pointH = new PD.Vectort2(3, 2);
	var list = [pointA, pointB, pointC, pointD, pointE, pointF, pointG, pointH];

	for (var i = 0; i < list.length - 1; i++) {
		for (var j = i + 1; j < list.length - 1; j++) {
			//双向互通
			map.add(new PD.Segment(list[i], list[j]));
			map.add(new PD.Segment(list[j], list[i]));
		}
	}
	map.add(new PD.Segment(list[5], list[7]));
	map.add(new PD.Segment(list[7], list[1]));
	map.add(new PD.Segment(list[6], list[7]));

	console.time("getMinpath: ");
	//获取路径最短.
	var nodes = PD.findPath(pointH, pointA, map);
	console.timeEnd("get min path: ");
	
	//绘图.
	function marPoint(node, R,color) {
		context.beginPath();
		var n = fixPosition(node);
		context.arc(n.x, n.y, R, 0, 2 * Math.PI, true);
		context.fillStyle = color||"gray";
		context.fill();
		if (!isNaN(node.id)) {
			context.fillStyle = "blue";
			context.font = "20px Georgia";
			context.fillText(node.id, n.x - 20, n.y - 20);
		}
		context.stroke();
		context.closePath();
	}
	function fixPosition(node) {
		return { x: 100 + node.x * 100, y: 100 + 100 * node.y };
	}


	function linePoint(nodeA, nodeB, linecloor, width) {
		context.beginPath();
		context.strokeStyle = linecloor || "black";
		context.lineWidth = width || 1;
		var a = fixPosition(nodeA);
		var b = fixPosition(nodeB);
		context.moveTo(a.x, a.y);
		context.lineTo(b.x, b.y);
		context.stroke();
		context.closePath();

		var v = { x: nodeB.x - nodeA.x, y: nodeB.y - nodeA.y };
		var vl = Math.sqrt(v.y * v.y + v.x * v.x);
		var st = { x: nodeA.x + v.x * 0.5, y: nodeA.y + v.y * 0.5 };
		marPoint(st, 3);
		marPoint({ x: st.x + 0.05 / vl * v.x, y: st.y + 0.05 / vl * v.y }, 1);
	}

	for (var key in map.segmentMap) {
		var s = map.segmentMap[key];
		linePoint(s.nodeA, s.nodeB, 'gray');
		
	}
	context.save();
	for (var i = 0; i < list.length; i++) {
		marPoint(list[i], 10);
	}


	//绘制最短路径.
	for (var i = 0; i < nodes.length - 1; i++) {
		linePoint(nodes[i], nodes[i + 1], "red", 2);
	}
</script>

</html>